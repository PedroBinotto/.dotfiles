#!/bin/bash

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

sudo -v

while true; do sudo -n true; sleep 60; done 2>/dev/null &
KEEP_ALIVE_PID=$!

echo '[INFO] Acrquired sudo permissions.'

echo '[INFO] Adding apt repositories...'

sudo apt-add-repository -y universe && sudo apt -y update

echo '[INFO] Installing apt packages...'

xargs sudo apt -y install < packagefile

echo '[INFO] Change default shell to ZSH'

chsh -s $(which zsh)

echo '[INFO] Export /etc/environment'

sudo sh -c 'cat ./env > /etc/environment'
source ./env

echo '[INFO] Export desktop entries'

sudo cp $SCRIPT_DIR/.helpers/kitty.desktop /usr/share/applications

echo '[INFO] Create new ~/.local/bin and ~/projects...'

mkdir ~/.local/bin ~/projects

echo '[INFO] Running custom installations...'

$SCRIPT_DIR/.helpers/go.sh
$SCRIPT_DIR/.helpers/nvm.sh
$SCRIPT_DIR/.helpers/docker.sh
$SCRIPT_DIR/.helpers/nerd-fonts.sh
$SCRIPT_DIR/.helpers/kitty.sh
$SCRIPT_DIR/.helpers/nvim.sh

make all

kill "$KEEP_ALIVE_PID"

echo 'Please reboot the system'
